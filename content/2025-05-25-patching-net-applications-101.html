<!DOCTYPE html> <html><head>
		<title>Using dnSpyEx to patch basic applications</title>
		<base href="../">
		<meta id="root-path" root-path="../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="coffeendata.github.io - Using dnSpyEx to patch basic applications">
		<meta property="og:title" content="Using dnSpyEx to patch basic applications">
		<meta property="og:description" content="coffeendata.github.io - Using dnSpyEx to patch basic applications">
		<meta property="og:type" content="website">
		<meta property="og:url" content="content/2025-05-25-patching-net-applications-101.html">
		<meta property="og:image" content="lib\media\pasted-image-20250525230613.png">
		<meta property="og:site_name" content="coffeendata.github.io">
		<script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered is-readable-line-width"><style id="MJX-CHTML-styles"></style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">title</span><span class="token punctuation">:</span> Using dnSpyEx to patch basic applications</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Using dnSpyEx to patch basic applications">Using dnSpyEx to patch basic applications</h1><div class="el-h2 heading-wrapper"><h2 data-heading="Introduction" dir="auto" class="heading" id="Introduction"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Introduction</h2><div class="heading-children"><div class="el-p"><p dir="auto">In the modern age, Windows reigns amongst the most used systems. Such is this fact that also many developers dedicate exclusively to the .NET framework.</p></div><div class="el-p"><p dir="auto">When debugging, researching and reversing .NET apps, we will find ourselves often wondering how to speed up some processes, skip product key checks, fix bugs on the fly or even adding custom features to closed-source software.</p></div><div class="el-p"><p dir="auto">In this post we will navigate through the basics of patching/modifying .NET applications (based in C#) to accomplish some of these tasks.</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="Disclaimer" dir="auto" class="heading" id="Disclaimer"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Disclaimer</h4><div class="heading-children"><div class="el-p"><p dir="auto">This is only for research and educational purposes. This does not aim in any way to encourage piracy or any other malicious intent against any kind of software.</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="Requirements" dir="auto" class="heading" id="Requirements"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Requirements</h4><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto"><a data-tooltip-position="top" aria-label="https://github.com/dnSpyEx/dnSpy" rel="noopener nofollow" class="external-link" href="https://github.com/dnSpyEx/dnSpy" target="_blank">dnSpyEx</a> (fork of dnSpy)</li>
</ul></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Using dnSpyEx to patch basic applications" dir="auto" class="heading" id="Using_dnSpyEx_to_patch_basic_applications"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Using dnSpyEx to patch basic applications</h2><div class="heading-children"><div class="el-p"><p dir="auto">This section aims to work as an introduction to dnSpy and how to modify simple, not-bundled, .NET apps.</p></div><div class="el-p"><p dir="auto">The code we will be using as a demonstration is as follows:</p></div><div class="el-pre"><pre class="language-cs" tabindex="0"><code data-line="0" class="language-cs is-loaded"><span class="token class-name"><span class="token keyword">string</span></span> correctPassword <span class="token operator">=</span> <span class="token string">"secret123"</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Please enter the password:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> userInput <span class="token operator">=</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>userInput <span class="token operator">==</span> correctPassword<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Correct"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Wrong"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">After compiling, we will be greeted with a bunch of files, such as an <code>.exe</code> file and <code>.dll</code> file under the <code>bin/Debug/net9.0/</code> folder with some other files.</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Compilation structure" dir="auto" class="heading" id="Compilation_structure"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Compilation structure</h2><div class="heading-children"><div class="el-p"><p dir="auto">Unless we "bundle" our apps, the produced EXE file will basically be a launcher for the DLL file, which will contain the real .NET code.</p></div><div class="el-p"><p dir="auto">Assuming we do not have any access to the source code, we would only see the EXE and the DLL. If we check the strings with any other application it would be easy to find the password. For demonstration purposes we will force the password to be correct instead of just peeking it.</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Opening it with dnSpy" dir="auto" class="heading" id="Opening_it_with_dnSpy"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Opening it with dnSpy</h2><div class="heading-children"><div class="el-p"><p dir="auto">Let's drop both files on dnSpy now. We will see the following:</p></div><div class="el-p"><p dir="auto"><span src="/assets/images/Pasted image 20250525230613.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250525230613.png"></span></p></div><div class="el-p"><p dir="auto">We can see dnSpy didn't detect the EXE file, but only the DLL. This confirms the information above.</p></div><div class="el-p"><p dir="auto">Lets dig in deeper. We will find the <code>main</code> under <code>src/src.dll/-/Program/&lt;Main&gt;</code>. Now we can see the recovered code with some extra compiler-generated artifacts.</p></div><div class="el-p"><p dir="auto"><span src="/assets/images/Pasted image 20250525231601.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250525231601.png"></span></p></div><div class="el-p"><p dir="auto">We are able to see the password, but this will not be the case under real conditions. In a realistic environment, we would search all the code to find the "Please enter the password" text, so we can quickly find the authentication logic. We will dig further into this later. We can now modify the code to force the condition on line 8 to be always true.</p></div><div class="el-p"><p dir="auto"><span src="/assets/images/Pasted image 20250525231925.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250525231925.png"></span><br>
<span src="/assets/images/Pasted image 20250525232112.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250525232112.png"></span></p></div><div class="el-p"><p dir="auto">We now have changed the condition to always be true. In theory this should work, but on practice:</p></div><div class="el-p"><p dir="auto"><span src="/assets/images/Pasted image 20250525232158.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250525232158.png"></span></p></div><div class="el-p"><p dir="auto">We see there are lots of compilation errors. This happens often because the compilation/decompilation artifacts that have been generated for us to see.</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Avoiding compiler errors" dir="auto" class="heading" id="Avoiding_compiler_errors"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Avoiding compiler errors</h2><div class="heading-children"><div class="el-p"><p dir="auto">To explain this, we should think about how other decompilers work. Imagine were dealing with a C program that we are reverse engineering with Ghidra. The code we would see is a reconstruction called pseudo-code, which aims to provide a general idea of what is going on, but by no means should be thought as precise or even valid. When we are not sure of what happens even with pseudo-code, we would look directly into the disassembly. In the .NET framework context, there is no assembly code, but instead a Java-like intermediate language (also called bytecode) called Common Intermediate Language (CIL) or Microsoft Intermediate Language (MSIL, used by Windows Defender definitions) which, just like Java, aims to provide multi platform code that should be re-compiled at runtime by the .NET virtual machine. The reference to the CIL instructions can be found <a data-tooltip-position="top" aria-label="https://en.wikipedia.org/wiki/List_of_CIL_instructions" rel="noopener nofollow" class="external-link" href="https://en.wikipedia.org/wiki/List_of_CIL_instructions" target="_blank">here</a>.</p></div><div class="el-p"><p dir="auto">Lets dig into the bytecode and find what we need to change. To do this, we need to change the disassembly mode from C# to IL with C#, which will provide a disassembly with the decompilation as reference.</p></div><div class="el-p"><p dir="auto"><span src="/assets/images/Pasted image 20250526105943.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250526105943.png"></span></p></div><div class="el-p"><p dir="auto">The resulting code looks like this:</p></div><div class="el-pre"><pre class="language-cs" tabindex="0"><code data-line="0" class="language-cs is-loaded"><span class="token punctuation">.</span>method <span class="token keyword">private</span> hidebysig <span class="token keyword">static</span> 
	<span class="token keyword">void</span> '<span class="token operator">&lt;</span>Main<span class="token operator">&gt;</span>$' <span class="token punctuation">(</span>
		<span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args
	<span class="token punctuation">)</span> <span class="token return-type class-name">cil</span> managed 
<span class="token punctuation">{</span>
	<span class="token punctuation">.</span>maxstack <span class="token number">2</span>
	<span class="token punctuation">.</span><span class="token return-type class-name">entrypoint
	<span class="token punctuation">.</span>locals</span> init <span class="token punctuation">(</span>
		<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">string</span></span> correctPassword<span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">string</span></span> userInput<span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">bool</span>
	<span class="token punctuation">)</span>


	<span class="token comment">//     string correctPassword = "secret123";</span>
	IL_0000<span class="token punctuation">:</span> ldstr     <span class="token string">"secret123"</span>
	IL_0005<span class="token punctuation">:</span> stloc<span class="token punctuation">.</span><span class="token number">0</span>

	<span class="token comment">//     Console.WriteLine("Please enter the password:");</span>
	IL_0006<span class="token punctuation">:</span> ldstr     <span class="token string">"Please enter the password:"</span>
	IL_000B<span class="token punctuation">:</span> call      <span class="token keyword">void</span> <span class="token punctuation">[</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">]</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">::</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>
	IL_0010<span class="token punctuation">:</span> nop

	<span class="token comment">//     string userInput = Console.ReadLine();</span>
	IL_0011<span class="token punctuation">:</span> call      <span class="token keyword">string</span> <span class="token punctuation">[</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">]</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">::</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	IL_0016<span class="token punctuation">:</span> stloc<span class="token punctuation">.</span><span class="token number">1</span>

	<span class="token comment">//     bool flag = userInput == correctPassword;</span>
	IL_0017<span class="token punctuation">:</span> ldloc<span class="token punctuation">.</span><span class="token number">1</span>
	IL_0018<span class="token punctuation">:</span> ldloc<span class="token punctuation">.</span><span class="token number">0</span>
	IL_0019<span class="token punctuation">:</span> call      <span class="token keyword">bool</span> <span class="token punctuation">[</span>System<span class="token punctuation">.</span>Runtime<span class="token punctuation">]</span>System<span class="token punctuation">.</span>String<span class="token punctuation">::</span>op_Equality<span class="token class-name"><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">)</span></span>
	IL_001E<span class="token punctuation">:</span> stloc<span class="token punctuation">.</span><span class="token number">2</span>

	<span class="token comment">//     if (flag)</span>
	IL_001F<span class="token punctuation">:</span> ldloc<span class="token punctuation">.</span><span class="token number">2</span>
	IL_0020<span class="token punctuation">:</span> brfalse<span class="token punctuation">.</span>s IL_0031


	<span class="token comment">//         Console.WriteLine("Correct");</span>
	IL_0022<span class="token punctuation">:</span> <span class="token class-name">nop</span>
	
	IL_0023<span class="token punctuation">:</span> ldstr     <span class="token string">"Correct"</span>
	IL_0028<span class="token punctuation">:</span> call      <span class="token keyword">void</span> <span class="token punctuation">[</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">]</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">::</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>
	IL_002D<span class="token punctuation">:</span> <span class="token class-name">nop</span>
	
	IL_002E<span class="token punctuation">:</span> <span class="token class-name">nop</span>
	
	IL_002F<span class="token punctuation">:</span> br<span class="token punctuation">.</span>s      IL_003E


	<span class="token comment">//         Console.WriteLine("Wrong");</span>
	IL_0031<span class="token punctuation">:</span> <span class="token class-name">nop</span>
	
	IL_0032<span class="token punctuation">:</span> ldstr     <span class="token string">"Wrong"</span>
	IL_0037<span class="token punctuation">:</span> call      <span class="token keyword">void</span> <span class="token punctuation">[</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">]</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">::</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>
	IL_003C<span class="token punctuation">:</span> <span class="token class-name">nop</span>
	
	IL_003D<span class="token punctuation">:</span> nop

	
	<span class="token comment">// }</span>
	IL_003E<span class="token punctuation">:</span> ret
<span class="token punctuation">}</span> <span class="token comment">// end of method Program::'&lt;Main&gt;$'</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Lets focus on this specific code segment:</p></div><div class="el-pre"><pre class="language-cs" tabindex="0"><code data-line="0" class="language-cs is-loaded">	<span class="token comment">//     if (flag)</span>
	IL_001F<span class="token punctuation">:</span> ldloc<span class="token punctuation">.</span><span class="token number">2</span>
	IL_0020<span class="token punctuation">:</span> brfalse<span class="token punctuation">.</span>s IL_0031


	<span class="token comment">//         Console.WriteLine("Correct");</span>
	IL_0022<span class="token punctuation">:</span> <span class="token class-name">nop</span>
	
	IL_0023<span class="token punctuation">:</span> ldstr     <span class="token string">"Correct"</span>
	IL_0028<span class="token punctuation">:</span> call      <span class="token keyword">void</span> <span class="token punctuation">[</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">]</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">::</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>
	IL_002D<span class="token punctuation">:</span> <span class="token class-name">nop</span>
	
	IL_002E<span class="token punctuation">:</span> <span class="token class-name">nop</span>
	
	IL_002F<span class="token punctuation">:</span> br<span class="token punctuation">.</span>s      IL_003E
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Citing the Wikipedia source above, <code>ldloc.2</code> loads "local variable 2 onto stack" and <code>brfalse.s</code> branches "to target if value is zero". This last instruction is equivalent to a JNE in x86 assembly. Keep the reference at hand to improve our understanding of the code segments.</p></div><div class="el-p"><p dir="auto">At this point, it checks if <code>flag</code> variable is set to <code>false</code>. If so, it then skips the code shown after the conditional. To reach the below code, we might want to use one of these two approaches:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Redirect the branch to jump to IL22 to never fail.</li>
<li data-line="1" dir="auto">Force the conditional to always return true.</li>
</ol></div><div class="el-p"><p dir="auto">I personally will be choosing the option one, but option 2 will look cleaner and more elegant in some cases.</p></div><div class="el-p"><p dir="auto">Now, we right click the code and select "Edit IL instructions":</p></div><div class="el-p"><p dir="auto"><span src="/assets/images/Pasted image 20250526112234.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250526112234.png"></span></p></div><div class="el-p"><p dir="auto">Here, the disassembly is a bit cleaner. We see which exact instruction the <code>brfalse.s</code> conditional is going to jump to after being run.</p></div><div class="el-p"><p dir="auto"><span src="/assets/images/Pasted image 20250526112534.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250526112534.png"></span></p></div><div class="el-p"><p dir="auto">Just by changing this to a 13, which points to a <code>nop</code> in the code path we want to follow, we will force the code to simply never fail the password check by always forcing a jump. Modifying this in dnSpy is very easy. To modify where to jump, dnSpy provides a drop-down menu to select the target instruction. We select line 13.</p></div><div class="el-p"><p dir="auto"><span src="/assets/images/Pasted image 20250526112953.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250526112953.png"></span></p></div><div class="el-p"><p dir="auto">Now we can see we successfully redirected the code. Since we have not used pseudo-code or decompilation, it successfully recompiles with the patched instruction. As a personal recommendation, always patch as less instructions as possible and try to use the IL editor instead of the C# view. This will often result in more stable, cleaner and better working patched binaries.</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Finishing up" dir="auto" class="heading" id="Finishing_up"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Finishing up</h2><div class="heading-children"><div class="el-p"><p dir="auto">To save the patched result, we go to "File" &gt; "Save Module".</p></div><div class="el-p"><p dir="auto"><span src="/assets/images/Pasted image 20250526113657.png" class="internal-embed media-embed image-embed is-loaded"><img src="lib/media/pasted-image-20250526113657.png"></span></p></div><div class="el-p"><p dir="auto">Saving a PDB file would be useful if we needed further debugging, but its not the case, so we uncheck that option and click OK to save the patched binary.</p></div><div class="el-p"><p dir="auto">Lets now run it:</p></div><div class="el-pre"><pre class="language-batch" tabindex="0"><code data-line="0" class="language-batch is-loaded">&gt; .\src.exe
<span class="token command"><span class="token keyword">Please</span> enter the password:</span>
&gt; wrongpassword12345
<span class="token command"><span class="token keyword">Correct</span></span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">It now works even with a wrong password.</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Conclusion" dir="auto" class="heading" id="Conclusion"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Conclusion</h2><div class="heading-children"><div class="el-p"><p dir="auto">This aims to be an introduction for the next post, as it will deep dive into how .NET bundles work, how to extract them and how to patch them without dying trying.</p></div><div class="mod-footer mod-ui"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button is-collapsed" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Using dnSpyEx to patch basic applications"><div class="tree-item-contents heading-link" heading-name="Using dnSpyEx to patch basic applications"><span class="tree-item-title">Using dnSpyEx to patch basic applications</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible is-collapsed" data-depth="2"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Introduction"><div class="tree-item-contents heading-link" heading-name="Introduction"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Introduction</span></div></a><div class="tree-item-children nav-folder-children" style="display: none;"><div class="tree-item" data-depth="4"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Disclaimer"><div class="tree-item-contents heading-link" heading-name="Disclaimer"><span class="tree-item-title">Disclaimer</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Requirements"><div class="tree-item-contents heading-link" heading-name="Requirements"><span class="tree-item-title">Requirements</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Using_dnSpyEx_to_patch_basic_applications"><div class="tree-item-contents heading-link" heading-name="Using dnSpyEx to patch basic applications"><span class="tree-item-title">Using dnSpyEx to patch basic applications</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Compilation_structure"><div class="tree-item-contents heading-link" heading-name="Compilation structure"><span class="tree-item-title">Compilation structure</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Opening_it_with_dnSpy"><div class="tree-item-contents heading-link" heading-name="Opening it with dnSpy"><span class="tree-item-title">Opening it with dnSpy</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Avoiding_compiler_errors"><div class="tree-item-contents heading-link" heading-name="Avoiding compiler errors"><span class="tree-item-title">Avoiding compiler errors</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Finishing_up"><div class="tree-item-contents heading-link" heading-name="Finishing up"><span class="tree-item-title">Finishing up</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2025-05-25-patching-net-applications-101.html#Conclusion"><div class="tree-item-contents heading-link" heading-name="Conclusion"><span class="tree-item-title">Conclusion</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>