<!DOCTYPE html> <html><head>
		<title>Cracking the Cracker: Ripping appart a blackhat tool</title>
		<base href="../">
		<meta id="root-path" root-path="../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="coffeendata.github.io - Cracking the Cracker: Ripping appart a blackhat tool">
		<meta property="og:title" content="Cracking the Cracker: Ripping appart a blackhat tool">
		<meta property="og:description" content="coffeendata.github.io - Cracking the Cracker: Ripping appart a blackhat tool">
		<meta property="og:type" content="website">
		<meta property="og:url" content="content/2021-11-07-cracking-the-cracker.html">
		<meta property="og:image" content="lib\media\(1).png">
		<meta property="og:site_name" content="coffeendata.github.io">
		<script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered is-readable-line-width"><style id="MJX-CHTML-styles"></style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">title</span><span class="token punctuation">:</span> <span class="token string">"Cracking the Cracker: Ripping appart a blackhat tool"</span></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Cracking the Cracker: Ripping appart a blackhat tool">Cracking the Cracker: Ripping appart a blackhat tool</h1><div class="el-p"><p dir="auto">Much of offensive security students and practitioners overlook the world that lies just below the scripts and the dreaded misconfigured permissions. You're probably already familiar with the famous Buffer Overflows - and overflows in general - and tired of frustratedly staring at the size of a buffer in GDB. Still, in the real world, not all exploitation consists of doing BoFs on a prepped Ubuntu, especially when the majority of the operating system market is governed by Microsoft.</p></div><div class="el-p"><p dir="auto">In this post, I'm going to address some general and practical aspects of reversing, exploitation, and binary manipulation in Windows. While I've used Windows 11 to do this, Windows 10 will work exactly the same.</p></div><div class="el-h2 heading-wrapper"><h2 data-heading="Requirements" dir="auto" class="heading" id="Requirements"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Requirements</h2><div class="heading-children"><div class="el-p"><p dir="auto">As a general rule, for working with Windows, I <strong>highly recommend</strong> the following tools (although I won't be using all of them):</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><a data-tooltip-position="top" aria-label="https://github.com/icsharpcode/ILSpy" rel="noopener nofollow" class="external-link" href="https://github.com/icsharpcode/ILSpy" target="_blank">ILSpy</a></li>
<li data-line="1" dir="auto"><a data-tooltip-position="top" aria-label="https://www.jetbrains.com/es-es/decompiler/" rel="noopener nofollow" class="external-link" href="https://www.jetbrains.com/es-es/decompiler/" target="_blank">dotPeek</a></li>
<li data-line="2" dir="auto"><a data-tooltip-position="top" aria-label="https://www.cheatengine.org/" rel="noopener nofollow" class="external-link" href="https://www.cheatengine.org/" target="_blank">Cheat Engine</a></li>
<li data-line="3" dir="auto">A Linux VM or <a data-tooltip-position="top" aria-label="https://docs.microsoft.com/es-es/windows/wsl/install" rel="noopener nofollow" class="external-link" href="https://docs.microsoft.com/es-es/windows/wsl/install" target="_blank">WSL</a> installed</li>
<li data-line="4" dir="auto"><a data-tooltip-position="top" aria-label="https://www.python.org/downloads/" rel="noopener nofollow" class="external-link" href="https://www.python.org/downloads/" target="_blank">Python3</a></li>
</ul></div><div class="el-p"><p dir="auto">Additionally, we'll need some experience with C, C#, and x86 and x64 assembly.</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Objective" dir="auto" class="heading" id="Objective"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Objective</h2><div class="heading-children"><div class="el-p"><p dir="auto">I'll be "attacking" a brute-force tool that I've acquired. I'll be covering up some parts to avoid potential conflicts with the author of this tool. I also want to make it clear that I don't take responsibility for nor endorse the misuse of this tool.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(1).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(1).png"></span></p></div><div class="el-p"><p dir="auto">This tool tries combinations like <code>username:password</code> on a website to verify which credentials are valid. To avoid problems, it uses a list of proxies that can be switched. For ethical reasons, I've created my own list of proxies and set up a lab, thus avoiding attacking a real website.</p></div><div class="el-p"><p dir="auto">We load a list of accounts and the list of proxies. Additionally, I've adjusted the number of threads to 300. But when we click that ominous "Start" button, it returns the following error:</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(2).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(2).png"></span></p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Reversing and Exploitation" dir="auto" class="heading" id="Reversing_and_Exploitation"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Reversing and Exploitation</h2><div class="heading-children"><div class="el-p"><p dir="auto">To set ourselves a goal, let's analyze how and why this window pops up. Before proceeding any further, we can take a look using ILSpy, as dnSpy is no longer maintained.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(3).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(3).png"></span></p></div><div class="el-p"><p dir="auto">We can distinguish 4 different DLL files within the same executable, but we only need to investigate the first one, as the other libraries are aesthetic. Furthermore, it's evident that the program is written in C#, which means the file is not exactly 32 or 64-bit assembly, but rather <strong>Microsoft IL</strong> (Intermediate Language), widely known as <strong>MSCIL</strong> (<em>Microsoft Common Intermediate Language</em>) or simply <strong>CIL</strong>, which is somewhat similar to Java bytecode. When a .NET program is compiled, it's converted into CIL, which despite being considered an assembly language, remains relatively high-level. This significantly facilitates its decompilation, but it eliminates the use of conventional static disassemblers like Ghidra or Cutter. From ILSpy, we can search for some keywords that appeared in the previous error to understand where to start:</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(4).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(4).png"></span></p></div><div class="el-blockquote"><blockquote dir="auto">
<p>If we click here, we can see the piece of code that interests us, but upon closer inspection, we realize that it doesn't actually do anything special.</p>
</blockquote></div><div class="el-pre"><pre class="language-csharp" tabindex="0"><code data-line="0" class="language-csharp is-loaded"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows</span><span class="token punctuation">;</span>

<span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">VerifyVersion</span>
<span class="token punctuation">{</span>
    <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsPaidVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Application<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Dispatcher<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"To access this feature, you need to purchase a paid version here: https://example.com \n\nPaid features:\n - Maximum of 999 threads (instead of 201);\n - All unlocked features;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">But we know that this piece of code gets executed, so we can search for references to this function and see where it's used.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(5).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(5).png"></span></p></div><div class="el-p"><p dir="auto">This function is called in the classes <code>sxesac.Classes.CheckerHandler.VerifyUserOptions</code> and <code>sxesac.Classes.Helpers.ProxyDownloader+d__2.MoveNext</code>. Just by the names, we understand that the one we're interested in is the first one, not the second. Let's decompile the <code>VerifyUserOptions()</code> function to see how it works:</p></div><div class="el-pre"><pre class="language-csharp" tabindex="0"><code data-line="0" class="language-csharp is-loaded"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">sxesac<span class="token punctuation">.</span>Classes<span class="token punctuation">.</span>Helpers</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">sxesac<span class="token punctuation">.</span>Classes<span class="token punctuation">.</span>Internal</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">sxesac<span class="token punctuation">.</span>Helpers</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">VerifyUserOptions</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> taskNumber<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskNumber <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Dispatcher<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"How do you want to get work done if you don't have any employees? Gotta hire some, no?\nYou can't have 0 threads.\n\nTo continue, specify at least 1 thread."</span><span class="token punctuation">,</span> <span class="token string">"No threads"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>LoadedAccountsCollection<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Your accounts list is empty.\n\nTo continue, add an accounts list."</span><span class="token punctuation">,</span> <span class="token string">"Accounts list is empty"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskNumber <span class="token operator">&gt;</span> LoadedAccountsCollection<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">int</span></span> count <span class="token operator">=</span> LoadedAccountsCollection<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"XXXX lowered the threads number you specified (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">taskNumber</span><span class="token punctuation">}</span></span><span class="token string">) because you loaded </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">LoadedAccountsCollection<span class="token punctuation">.</span>Count</span><span class="token punctuation">}</span></span><span class="token string"> accounts.\n\nXXXXX will continue checking accounts with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">count</span><span class="token punctuation">}</span></span><span class="token string"> threads."</span></span><span class="token punctuation">,</span> <span class="token string">"You can't have more threads than accounts"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskNumber <span class="token operator">=</span> count<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ProxyHelper<span class="token punctuation">.</span>LoadedProxiesCollection<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Your proxies list is empty.\n\nTo continue, add a proxy list."</span><span class="token punctuation">,</span> <span class="token string">"Proxy list is empty"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskNumber <span class="token operator">&gt;</span> ProxyHelper<span class="token punctuation">.</span>LoadedProxiesCollection<span class="token punctuation">.</span>Count <span class="token operator">&amp;&amp;</span> ProxyModifier<span class="token punctuation">.</span>proxyMethod <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Your thread number is bigger than the proxies you loaded.\n\nTo continue, lower your threads list or load more proxies using the Stack-Add feature."</span><span class="token punctuation">,</span> <span class="token string">"Threads are bigger than proxy number"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskNumber <span class="token operator">&gt;</span> <span class="token number">201</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>VerifyVersion<span class="token punctuation">.</span><span class="token function">IsPaidVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">Cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    isChecking <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">In the highlighted bold section, you can find the maximum number of threads allowed in the free version of the program along with a call to the function <code>sxesac.Classes.Internal.VerifyVersion.IsPaidVersion()</code>, which we encountered above. This seems like a clue that we're on the right track. However, if we look closely, we can see that all the conditionals end with <code>return false</code>, except for one:</p></div><div class="el-pre"><pre><code data-line="0">if (taskNumber &gt; LoadedAccountsCollection.Count)
{
    int count = LoadedAccountsCollection.Count;
    MessageBox.Show($"lowered the threads number you specified ({taskNumber}) because you loaded {LoadedAccountsCollection.Count} accounts.\n\nXXXXX will continue checking accounts with {count} threads.", "You can't have more threads than accounts", MessageBoxButton.OK, MessageBoxImage.Exclamation);
    taskNumber = count;
    return true;
}
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">It seems like something interesting. All the conditionals check if something is out of place and return <code>false</code> if something is wrong. In this part, that condition is not met, and we can exit the function early by returning true arbitrarily. Finally, we have found a bug.</p></div><div class="el-p"><p dir="auto">Now let's open one of my favorite tools to take a closer look: Cheat Engine. We select the process and open it with the debugger:</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(6).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(6).png"></span></p></div><div class="el-p"><p dir="auto">After opening the process and searching for the value 201, which is the number of threads, we get quite a few results. To filter them, we just need to change the value and scan again with the new value.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(7).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(7).png"></span></p></div><div class="el-p"><p dir="auto">And now we know where the thread count is located in memory. However, due to <strong>ASLR</strong> (Address Space Layout Randomization), this information won't be very useful the next time we open it with Cheat Engine. Let's find a way to overcome this using an option that CE provides to identify which parts of the code access that variable.</p></div><div class="el-p"><p dir="auto">Please note that since <strong>MSCIL is compiled at runtime</strong>, what we'll be analyzing with CE from now on <strong>will be proper assembly language</strong>.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(8).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(8).png"></span></p></div><div class="el-p"><p dir="auto">Now, all we need is to have something interact with that variable, so let's click "Start" in the program and observe what accesses it.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(9).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(9).png"></span></p></div><div class="el-p"><p dir="auto">After clicking a few times to make sure that's the part we're interested in, we select it, and now we can see something more interesting: the variable is stored in <code>[rax+98]</code> (in hexadecimal notation). With Cheat Engine, we can inject our own code, but it's recommended to have experience with C and 32-bit and 64-bit assembly. Now let's open that part of the code:</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(10).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(10).png"></span></p></div><div class="el-p"><p dir="auto">With <code>CTRL+A</code>, we open the CE's "Auto Assemble" module, where we can write our code. Starting from scratch on what we want to do now is extremely tedious, so let's go to <code>_Template &gt; AOB Injection</code>. What this template does is select an AOB with the opcodes of the code portion where we want to inject. An AOB (Array Of Bytes) is, as the name suggests, a sequence of specific bytes.</p></div><div class="el-p"><p dir="auto">CE will now ask us for the address where we want to inject and a name for the script. For the address, we'll leave it as it is. For the name, I recommend using a descriptive name <strong>WITHOUT</strong> spaces. Personally, I'll name it <code>_INJECT_</code>.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(11).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(11).png"></span></p></div><div class="el-p"><p dir="auto">What we want to do now is to save the memory address in a variable that we control, so let's create some memory space using the <code>alloc()</code> function.</p></div><div class="el-pre"><pre class="language-assembly" tabindex="0"><code data-line="0" class="language-assembly is-loaded">[ENABLE]

aobscan(INJECT,8B 80 98 00 00 00 5D) // should be unique
alloc(newmem,$1000,INJECT)
globalalloc(thread_count,4)

label(code)
label(return)

thread_count:
  dd 0

newmem:

code:
  mov [thread_count],rax
  mov eax,[rax+00000098]
  jmp return

INJECT:
  jmp newmem
  nop
return:
registersymbol(INJECT)

[DISABLE]

INJECT:
  db 8B 80 98 00 00 00

unregistersymbol(INJECT)
dealloc(newmem)
dealloc(thread_count)
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">I've highlighted the code that I added. The <code>globalalloc()</code> function reserves memory space for our variable and makes it globally accessible. It takes the arguments <code>thread_count</code> (what to name the variable) and <code>4</code> (the size in bytes). Then, I initialize the variable with <code>thread_count:</code> and set its value to 0 with <code>dd 0</code>. Later on, I save the value of rax in <code>thread_count</code>. After adding the script, select <code>File &gt; Assign to current cheat table</code> so that we can use the script.</p></div><div class="el-p"><p dir="auto">However, it's still not clear what this script does, right? What it does is store the address of <code>rax</code> (without adding the 98-byte difference) in the memory address pointed to by <code>thread_count</code>, <strong>in other words, in our variable</strong>. Still, if we don't access it, it won't be of much use. It's crucial to use <code>globalalloc()</code> instead of <code>alloc()</code> if we plan to access this variable manually, as <strong>it makes it global and therefore accessible to the rest of the program and any added scripts</strong>.</p></div><div class="el-p"><p dir="auto">After assigning the script to our cheat table, it would be beneficial to give it a descriptive description and name.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(12).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(12).png"></span></p></div><div class="el-p"><p dir="auto"><em>Note: Some addresses might change due to restarting the program and Cheat Engine during certain checks. If there's something noticeable or worth mentioning, I'll explicitly mention it.</em></p></div><div class="el-p"><p dir="auto">On the left, you can see checkboxes under the "Active" label. If we mark the checkbox next to a value or a variable, <strong>we freeze it</strong>, preventing it from changing its value. If we mark it on a script, the code in the section under the <code>[ENABLE]</code> label will be executed, and if we unmark it, the section under the <code>[DISABLE]</code> label will be executed in that script.</p></div><div class="el-pre"><pre class="language-assembly" tabindex="0"><code data-line="0" class="language-assembly is-loaded">[ENABLE]

aobscan(INJECT,8B 80 98 00 00 00 5D) // should be unique
alloc(newmem,$1000,INJECT)
globalalloc(thread_count,4)

label(code)
label(return)

thread_count:
  dd 0

newmem:

code:
  mov [thread_count],rax
  mov eax,[rax+00000098]
  jmp return

INJECT:
  jmp newmem
  nop
return:
registersymbol(INJECT)

[DISABLE]

INJECT:
  db 8B 80 98 00 00 00

unregistersymbol(INJECT)
dealloc(newmem)
dealloc(thread_count)

...
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Now, let's see the value of our variable. To do this, let's select the option that says "Add address manually". <strong>It's of vital importance to consider the following concepts</strong>:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">The value stored in <code>thread_count</code> is a <strong>pointer</strong>.</li>
<li data-line="1" dir="auto">That pointer is for <code>rax</code>, <strong>not for <code>rax+98</code>, which is the one we're interested in</strong>.</li>
<li data-line="2" dir="auto">To update the value, we'll have to <strong>execute the script</strong>.</li>
</ol></div><div class="el-p"><p dir="auto">So, how are we going to proceed? In the "Address" field, we'll type <code>[thread_count]+98</code>. By putting it in brackets, <strong>we are treating it as a pointer and not a numerical value</strong>. The <code>+98</code> following it is the offset to the value we want to see. At this point, this is equivalent to <code>[rax+00000098]</code>, but with variables we control.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(13).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(13).png"></span></p></div><div class="el-p"><p dir="auto">With that and a relatively decent description, it's ready. Even though it shows that <strong>Cheat Engine currently has no idea what address we're telling it</strong>, that's because we haven't executed the script yet, and it hasn't been reserved or initialized in memory. So, let's do that.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(14).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(14).png"></span></p></div><div class="el-p"><p dir="auto"><em>You can nest values and scripts by dragging them onto each other.</em></p></div><div class="el-p"><p dir="auto">Now it's injected, but it hasn't been executed yet. The reason is that the part of the code where we injected it hasn't been executed yet. To make it execute in this case, <strong>simply click "Start"</strong>.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(15).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(15).png"></span></p></div><div class="el-p"><p dir="auto"><em>When clicking start with the script activated, our variable updates to the desired value.</em></p></div><div class="el-p"><p dir="auto">This technique is extremely useful for efficiently debugging programs, and contrary to popular belief, <strong>Cheat Engine isn't just for games</strong>. Now that we have what we want, we can remove the first cell because it holds a static address, meaning the next time we start the program, it will look at the address it's currently assigned to, which means it won't give us the value we're looking for due to the aforementioned ASLR. On the other hand, the third cell is dynamic, meaning it will change and adapt the next time due to the script we created.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(16).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(16).png"></span></p></div><div class="el-p"><p dir="auto"><em>Even though it displays the same address, it's dynamic because its value is <code>[thread_count]+98</code>.</em></p></div><div class="el-p"><p dir="auto">Now that our environment is set up, let's see if we can do something. First, let's save the cheat table so that we can open it later and verify that our script works flawlessly.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(17).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(17).png"></span></p></div><div class="el-p"><p dir="auto"><em>You can use</em>&nbsp;File &gt; Save As&nbsp;<em>to save your cheat table for later.</em></p></div><div class="el-p"><p dir="auto">Now, we can close CE and the application in question, then reopen ILSpy for the part of the code with a bug.</p></div><div class="el-pre"><pre class="language-csharp" tabindex="0"><code data-line="0" class="language-csharp is-loaded"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">sxesac<span class="token punctuation">.</span>Classes<span class="token punctuation">.</span>Helpers</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">sxesac<span class="token punctuation">.</span>Classes<span class="token punctuation">.</span>Internal</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">sxesac<span class="token punctuation">.</span>Helpers</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">VerifyUserOptions</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> taskNumber<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskNumber <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Current<span class="token punctuation">.</span>Dispatcher<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"How do you want to get work done if you don't have any employees? Gotta hire some, no?\nYou can't have 0 threads.\n\nTo continue, specify at least 1 thread."</span><span class="token punctuation">,</span> <span class="token string">"No threads"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>LoadedAccountsCollection<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Your accounts list is empty.\n\nTo continue, add an accounts list."</span><span class="token punctuation">,</span> <span class="token string">"Accounts list is empty"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskNumber <span class="token operator">&gt;</span> LoadedAccountsCollection<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">int</span></span> count <span class="token operator">=</span> LoadedAccountsCollection<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"XXXXX lowered the threads number you specified (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">taskNumber</span><span class="token punctuation">}</span></span><span class="token string">) because you loaded </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">LoadedAccountsCollection<span class="token punctuation">.</span>Count</span><span class="token punctuation">}</span></span><span class="token string"> accounts.\n\nXXXX will continue checking accounts with </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">count</span><span class="token punctuation">}</span></span><span class="token string"> threads."</span></span><span class="token punctuation">,</span> <span class="token string">"You can't have more threads than accounts"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskNumber <span class="token operator">=</span> count<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ProxyHelper<span class="token punctuation">.</span>LoadedProxiesCollection<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Your proxies list is empty.\n\nTo continue, add a proxy list."</span><span class="token punctuation">,</span> <span class="token string">"Proxy list is empty"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskNumber <span class="token operator">&gt;</span> ProxyHelper<span class="token punctuation">.</span>LoadedProxiesCollection<span class="token punctuation">.</span>Count <span class="token operator">&amp;&amp;</span> ProxyModifier<span class="token punctuation">.</span>proxyMethod <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"Your thread number is bigger than the proxies you loaded.\n\nTo continue, lower your threads list or load more proxies using the Stack-Add feature."</span><span class="token punctuation">,</span> <span class="token string">"Threads are bigger than proxy number"</span><span class="token punctuation">,</span> MessageBoxButton<span class="token punctuation">.</span>OK<span class="token punctuation">,</span> MessageBoxImage<span class="token punctuation">.</span>Exclamation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>taskNumber <span class="token operator">&gt;</span> <span class="token number">201</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>VerifyVersion<span class="token punctuation">.</span><span class="token function">IsPaidVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">Cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    isChecking <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">I've highlighted the bug in bold. This bug occurs when the number of threads is greater than the number of loaded accounts. If this happens, the program reduces the number of threads to match the number of loaded accounts and exits the function early, returning a <code>true</code>. The code that comes after wouldn't be executed, making it similar to a broken access control or <em>Broken Access Control</em> issue. Let's put it into practice to see if it works. To do this, we'll open the program alongside Cheat Engine to see if it's true that this number of threads gets reduced.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(18).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(18).png"></span></p></div><div class="el-p"><p dir="auto"><em>Note that in the second cell, we no longer have an address, but the value that will be considered.</em></p></div><div class="el-p"><p dir="auto">To have everything ready, we just need to activate the script and click "Start" in the program. After that, we can load our combo list and some placeholder proxies. Then, all we need to do is set the number of threads to be greater than the number of loaded accounts.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(19).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(19).png"></span></p></div><div class="el-p"><p dir="auto"><em>Everything is ready to exploit the bug.</em></p></div><div class="el-p"><p dir="auto">Now, click "Start". What we expect now is for the number of threads to change in CE and to be greater than the 201-thread limit.</p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(20).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(20).png"></span></p></div><div class="el-p"><p dir="auto"><em>That's the warning we were waiting for.</em></p></div><div class="el-p"><p dir="auto"><span alt="Picture" src="/assets/images/2021-11-07/(21).png" class="internal-embed media-embed image-embed is-loaded"><img alt="Picture" src="lib/media/(21).png"></span></p></div><div class="el-p"><p dir="auto"><em>Proof that the number of threads has indeed changed, as we expected.</em></p></div><div class="el-p"><p dir="auto">Here, we can see that we get the expected warning. I clicked "OK" and left it running for a few seconds to verify that the program doesn't crash or become corrupted, and then I clicked the "Stop" button to halt it. In the second image, we can see that the number has changed exactly to the number of loaded combos, and it's greater than the 201-thread limit. Finally, we've analyzed the code, conducted some tests, set up a simple analysis environment, and furthermore, found and exploited a <em>Broken Access Control</em> vulnerability.</p></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Conclusion" dir="auto" class="heading" id="Conclusion"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Conclusion</h2><div class="heading-children"><div class="el-p"><p dir="auto">While investigating programs and developing certain exploits can be extremely intimidating, <strong>with the right tools, patience, and a willingness to learn, anything is achievable</strong>. Before discovering this program, I had very little knowledge about exploitation and working in Windows environments, as I had mainly focused on Linux/Unix-based ones. I've learned much more than I thought, and I've gained an understanding of how a significant portion of the <em>.NET Core</em> works, demonstrating that the ambition to learn is everything in this field.</p></div><div class="el-p"><p dir="auto">As a final note, this post was written in Spanish by me. This post was originally uploaded at <a data-tooltip-position="top" aria-label="https://blog.asturhackers.es/crackeando-el-cracker-una-vision-practica-del-reversing-en-windows" rel="noopener nofollow" class="external-link" href="https://blog.asturhackers.es/crackeando-el-cracker-una-vision-practica-del-reversing-en-windows" target="_blank">AsturHackers' Website</a></p></div><div class="mod-footer mod-ui"></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button is-collapsed" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="content\2021-11-07-cracking-the-cracker.html#Cracking the Cracker: Ripping appart a blackhat tool"><div class="tree-item-contents heading-link" heading-name="Cracking the Cracker: Ripping appart a blackhat tool"><span class="tree-item-title">Cracking the Cracker: Ripping appart a blackhat tool</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2021-11-07-cracking-the-cracker.html#Requirements"><div class="tree-item-contents heading-link" heading-name="Requirements"><span class="tree-item-title">Requirements</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2021-11-07-cracking-the-cracker.html#Objective"><div class="tree-item-contents heading-link" heading-name="Objective"><span class="tree-item-title">Objective</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2021-11-07-cracking-the-cracker.html#Reversing_and_Exploitation"><div class="tree-item-contents heading-link" heading-name="Reversing and Exploitation"><span class="tree-item-title">Reversing and Exploitation</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="content\2021-11-07-cracking-the-cracker.html#Conclusion"><div class="tree-item-contents heading-link" heading-name="Conclusion"><span class="tree-item-title">Conclusion</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>